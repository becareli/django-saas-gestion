{% extends "gestion/base.html" %}

{% block title %}Listado de Proyectos CEV{% endblock %}

{% block content %}
    <h1 class="page-header"><i class="fas fa-clipboard-list"></i> Listado de Proyectos (CRUD)</h1>
    
    <p><a href="{% url 'proyecto-crear' %}" class="btn btn-success"><i class="fas fa-plus"></i> **Crear Nuevo Proyecto**</a></p>

    {% if proyectos_recientes %}
    <div class="alert alert-info" role="alert">
        <h4 class="alert-heading">✅ Requisito 5 Demostración ORM (Proyectos Recientes)</h4>
        <p class="mb-0">Se han iniciado <strong>{{ proyectos_recientes|length }}</strong> proyectos desde el inicio del mes actual. Esto demuestra el uso de métodos de filtrado (`.filter()`) del ORM de Django.</p>
    </div>
    {% endif %}
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Nombre del Proyecto (Vivienda)</th>
                <th>Cliente</th>
                <th>Tipo</th>
                <th>Fecha de Inicio</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for proyecto in proyectos %}
            <tr>
                <td>{{ proyecto.pk }}</td>
                <td><a href="{% url 'proyecto-detalle' proyecto.pk %}">{{ proyecto.nombre }}</a></td>
                <td>{{ proyecto.cliente.nombre }}</td>
                <td>{{ proyecto.tipo.nombre }}</td>
                <td>{{ proyecto.fecha_inicio|date:"Y-m-d" }}</td>
                <td class="table-actions">
                    <a href="{% url 'proyecto-detalle' proyecto.pk %}" class="btn btn-sm btn-info" title="Ver Detalle"><i class="fas fa-eye"></i></a>
                    <a href="{% url 'proyecto-editar' proyecto.pk %}" class="btn btn-sm btn-warning" title="Editar"><i class="fas fa-edit"></i></a>
                    <a href="{% url 'proyecto-eliminar' proyecto.pk %}" class="btn btn-sm btn-danger" title="Eliminar"><i class="fas fa-trash"></i></a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">No hay proyectos de vivienda registrados.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}